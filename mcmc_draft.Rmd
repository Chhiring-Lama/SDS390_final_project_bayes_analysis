---
title: "Normal linear regression_draft"
author: "Chhiring Lama, Sakaiza Rasolofomanana Rajery"
date: "12/11/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(bayesplot)
library(rstan)
library(rstanarm)
```
# Explaining the association between exercising and academic performance



## Background

## Data set
```{r}
library(Lock5Data)
data(GPAGender)
```

##Analysis

**Variables**
In this model, we used the following variables:

Exercise (hours): Response variable, which is continuous
SAT (point) : Explanatory variable, which is continuous
GPA ( point): Explanatory variable, which is continuous

**Defining parameters**

Assuming that there is a linear association between exercise and SAT and GPA. The expected amount of exercise (Y) in hour for a student _i_ as a function of GPA (X) and SAT(Z) for that student ca be written as:

$Y_i$ = $\beta_0$ + $\beta_1$ * $X_i$ + $\beta_2$ *$Z_i$ + $\epsilon_i$ ~ N(0, $\sigma$)
where:

$\beta_0$ : The amount of exercise in hour when GPA and SAT score are both 0
$\beta_1$ : When SAT is kept constant, $\beta_1$ is the increase in hours of of exercise for every point increase in the student's GPA
$\beta_2$ : When GPA is kept constant, $\beta_2$ is the increase in hours of exercise for every point increase in the student's SAT
$\epsilon_i$: is a measure of the variability of Y for students with similar GPA and SAT scores. 

**Hypothesis**

We hypothesized that there is a negative association between hours of exercise and GPA, SAT. 

As GPA increases, the number of hours a student exercises decreases. Mathematically:
$H_0$ : $\beta_1$ = 0
$H_a$ : $\beta_1$ < 0

As SAT score increases, the number of hours a student exercise decreases. Mathematically:
$H_0$ : $\beta_2$ = 0
$H-a$ : $\beta_2$ < 0

**Building the Regression Model**

To identify the association between the number of hours exercised and GPA and SAT, a multiple linear regression was run with SAT score, GPA score and Pulse rate as the predictors and `Exercise` as the dependent variable. Pulse rate was added as an indicator to increase the accuracy of the model. 




```{r}
set.seed(563453)

gpa_model_sim <- stan_glm(Exercise ~ SAT + GPA + Pulse , data = GPAGender, family=  gaussian, chains = 4, iter = 10000*2)
``` 

**diagnosis**
```{R}
mcmc_trace(gpa_model_sim, size = 0.1)

```

```{r}
mcmc_dens_overlay(gpa_model_sim)

```

## Interpreting the posterior
**Posterior summary statistics**
```{r}
gpa_model_summary <- summary(gpa_model_sim)
head(as.data.frame(model_summary),-2)

```


**Posterior credible interval**
Note: Correct intercept into GPA and SAT
```{R}
posterior_interval(gpa_model_sim, prob = 0.90)
mcmc_areas(gpa_model_sim,
           pars = c("(Intercept)"),
           prob = 0.90,
           prob = 0.90)
```

## Hypothesis testing

**Data frame creation**

```{r}
library(tidyverse)
library(reshape2)
gpa_model_df <- as.array(gpa_model_sim) %>%
melt %>%
pivot_wider(names_from = parameters, values_from = value)
```

**Posterior probability that $\beta_1$<0**
```{r}
gpa_model_df %>%
  mutate(exceeds_0 = temp_feel > 0) %>%
  tabyl(exceeds_0)
```


**posterior prediction when GPA = 3.5**

```{r}
set.seed(563453)
r_prediction <- posterior_predict(
  gpa_model_sim,
  newdata = data.frame(GPA = 3.5)
)
mcmc_dens(r_prediction) + 
  labs(x = "predicted hours of exercise when GPA = 3.5")
```

**posterior prediction when GPA = 2.5**

```{r}
set.seed(563453)
r2_prediction <- posterior_predict(
  gpa_model_sim,
  newdata = data.frame(GPA = 2.5)
)
mcmc_dens(r2_prediction) + 
  labs(x = "predicted hours of exercise when GPA = 2.5")
```

**posterior prediction when SAT = 1500**

```{r}
set.seed(563453)
r3_prediction <- posterior_predict(
  gpa_model_sim,
  newdata = data.frame(SAT = 1500)
)
mcmc_dens(r3_prediction) + 
  labs(x = "predicted hours of exercise when SAT = 1500")
```

**posterior prediction when SAT = 1000**

```{r}
set.seed(563453)
r4_prediction <- posterior_predict(
  gpa_model_sim,
  newdata = data.frame(SAT = 1000)
)
mcmc_dens(r4_prediction) + 
  labs(x = "predicted hours of exercise when SAT = 1000")
```
